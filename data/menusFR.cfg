exec "data/menusmap.cfg"
exec "data/obr.cfg"

bindactions = [Avancer Reculer Gauche Droite Sauter Tirer Recharger Accroupir Zoomer Scores Grenades CaC Aptitude_1 Aptitude_2 Aptitude_3 Tchat Arme_suivante Arme_précédente Screenshot  Ajouter_bot Retirer_bot]
classes = [Soldat Soldat Médecin Américain Ninja Vampire Magicien Kamikaze Faucheuse]

newgui connect [
	if (= $connecteaujeu 1) [showgui mainmenu]
	guititle "CISLATTACK ALPHA v0.0.9"
	guibar
	guilist [
		guitext "Pseudonyme : "
		guistrut 1.4
		newname = (getname)
		guifield newname 15 [name $newname]
	]
	guilist [
		guitext "Mot de passe : "
		//newpass = (getpass)
		guifield password 15 //[password $newpass]
	]
	guistrut 0.5
	guilist [
		guitext "Se connecter" 			"action" //[seconnecter $newname $newpass]
		guibar
		guibutton "Jouer en invité" 	[seconnecter ; clearconsole]
		guibar
		guibutton "Quitter"				[quit] "exit"
	]
] 0

newgui mainmenu [ 
		guititle (concatword "Bienvenue, " (at $getname $getname) " !")
		guibar
		guilist [
			guilist [
				guibutton (concat "Smiley :" (playermodelname)) [guirolloveraction = (playermodelbutton $playermodel); showgui playermodel] (playermodelicon)
				guibutton "Aptitudes" 		"showgui aptitudes"
				guibutton "Customisation"	"showgui custom"
				guibutton "Succès"			"showgui succes"
				guibutton "Statistiques"	"showgui stats"
				guistrut 0.5
				guibar
				guistrut 0.5
				guibutton "Multijoueurs"  			[showgui serveurs]
				guibutton "Jeu contre bots"   		[showgui match]
				guibutton "Editeur de maps"			[showgui menuedition ; mode 0]
				guibutton "Contributeurs"        	[showgui credits]
				guibutton "Options"  				[showgui options] "options"
				guibutton "Quittay"        			[quit] "exit"			
			]
		guibar
			guilist [
				guilist [
					guistrut 0.4
					guilist [
						if (= $classe 1) [guiimage "packages/icons/soldat.jpg" "" 0 0]
						if (= $classe 2) [guiimage "packages/icons/medecin.jpg" "" 0 0]
						if (= $classe 3) [guiimage "packages/icons/americain.jpg" "" 0 0]
						if (= $classe 4) [guiimage "packages/icons/ninja.jpg" "" 0 0]
						if (= $classe 5) [guiimage "packages/icons/vampire.jpg" "" 0 0]
						if (= $classe 6) [guiimage "packages/icons/magicien.jpg" "" 0 0]
						if (= $classe 7) [guiimage "packages/icons/kamikaze.jpg" "" 0 0]
						if (= $classe 8) [guiimage "packages/icons/faucheuse.jpg" "" 0 0]
					]
					guilist [
						guitext (concatword (at $classes $classe))
						guitext (concatword "Niveau : " (at $niveaumenu))
					]
				]
				guitext "Cislacoins : N/A" "cislacoin"
				guitext "Ratio : N/A"
				guibar
				if (= $playermodel 0) [guiplayerpreview smileys/hap 0 $vwep $guirolloveraction 4.5 0]
				if (= $playermodel 1) [guiplayerpreview smileys/noel 0 $vwep $guirolloveraction 4.5 0]
				if (= $playermodel 2) [guiplayerpreview smileys/sournois 0 $vwep $guirolloveraction 4.5 0]
				if (= $playermodel 3) [guiplayerpreview smileys/cool 0 $vwep $guirolloveraction 4.5 0]
				if (= $playermodel 4) [guiplayerpreview smileys/fou 0 $vwep $guirolloveraction 4.5 0]
			]
		]
	guibar
	guilist [
		guistrut 5
		guibutton "Site web"    	[ouvrirsite]
		guibar
		guibutton "Wiki"    		[ouvrirwiki]
		guibar
		guibutton "Forum"    		[ouvrirforum]
		guistrut 5
	]
] 0

newgui mainmenuingame [
	guilist [
		if (|| $editing (m_edit (getmode))) [
			guilist [
				guibutton "Editeur de map" 		"showgui Edition"
				guibutton "Editeur simplifié"	[showgui obrmodels]
				guibutton "Sauvegarder la map" savemap
				guibutton "Optimiser la géométrie" remip
				guibutton "Télécharger la map du serveur" getmap
				guibutton "Envoyer la map sur le serveur" sendmap
			]
		] [
			guilist [
				guibutton (concat "Smiley :" (playermodelname)) [guirolloveraction = (playermodelbutton $playermodel); showgui playermodel] (playermodelicon)
				guibutton "Aptitudes" 		"showgui aptitudes"
				guibutton "Customisation"	"showgui custom"
				guibutton "Succès"			"showgui succes"
				guibutton "Statistiques"	"showgui stats"
			]
			guibar
			guilist [
				guilist [
					guistrut 0.4
					guilist [
						if (= $classe 1) [guiimage "packages/icons/soldat.jpg" "" 0 0]
						if (= $classe 2) [guiimage "packages/icons/medecin.jpg" "" 0 0]
						if (= $classe 3) [guiimage "packages/icons/americain.jpg" "" 0 0]
						if (= $classe 4) [guiimage "packages/icons/ninja.jpg" "" 0 0]
						if (= $classe 5) [guiimage "packages/icons/vampire.jpg" "" 0 0]
						if (= $classe 6) [guiimage "packages/icons/magicien.jpg" "" 0 0]
						if (= $classe 7) [guiimage "packages/icons/kamikaze.jpg" "" 0 0]
						if (= $classe 8) [guiimage "packages/icons/faucheuse.jpg" "" 0 0]
					]
					guilist [
					guitext (concatword (at $classes $classe))
						guitext (concatword "Niveau : " (at $niveaumenu))
					]
				]				
				guitext "Cislacoins : N/A" "cislacoin"
				guitext "Ratio : N/A"
			]
		]
	]
	guibar
	guibutton "Votay le mode/la map" 	[showgui vote]
	guibutton "Changay d'équipe" 		[if (strcmp (getteam) "YOLO") [team SWAG] [team YOLO]]
	guibutton "Devenir spectateur" 		[nextfollow ; spectator (! (isspectator (getclientnum)))] "spectateur"
	guibutton "Se suiciday" 			[kill]
	guibutton "Options"  				[showgui options] "options"
	guibutton "Se déconnectay" 			[disconnect ; clearai] "exit"
] 0

newgui custom [
	guititle "CUSTOMISATION"
	guibar
	guilist [
		guilist [
			guilist [
				guilist [
					guititle "HATS"
					guibar
					guiradio "Aucun"		hat 0
					guiradio "Sombrero" 	hat 1
					guiradio "Lapin" 		hat 2
					guiradio "Auréole" 		hat 3
					guiradio "Cornes" 		hat 4
					guiradio "Joker" 		hat 5
					guiradio "Champignon" 	hat 6
				]
				guibar
				guilist [
					guititle "PREVISUALISATION"
					guibar
					if (= $hat 1) [guimodelpreview chapeaux/sombrero/gui 0 0 3 0]
					if (= $hat 2) [guimodelpreview chapeaux/lapin/gui 0 0 3 0]
					if (= $hat 3) [guimodelpreview chapeaux/aureole/gui 0 0 3 0]
					if (= $hat 4) [guimodelpreview chapeaux/cornes/gui 0 0 3 0]
					if (= $hat 5) [guimodelpreview chapeaux/joker/gui 0 0 3 0]
					if (= $hat 6) [guimodelpreview chapeaux/champignon/gui 0 0 3 0]
				]
			]
		]
	]
] 0

newgui aptitudes [
	guititle "APTITUDES"
	guibar
	if (= $guiaptitude 0) [
		guitext "Impossible de changer d'aptitude en étant vivant !"
		guibar
	]
	guilist [
		if (= $guiaptitude 1) [
			guilist [
				guilist [
					guiimage "packages/icons/soldat.jpg" "" 0.5 0
					guiradio "Soldat"      	classe 1
				]
				guilist [
					guiimage "packages/icons/medecin.jpg" "" 0.5 0
					guiradio "Médecin"		classe 2
				]
				guilist [
					guiimage "packages/icons/americain.jpg" "" 0.5 0
					guiradio "Américain"    classe 3
				]
				guilist [
					guiimage "packages/icons/ninja.jpg" "" 0.5 0
					guiradio "Ninja"        classe 4
				]
				guilist [
					guiimage "packages/icons/vampire.jpg" "" 0.5 0
					guiradio "Vampire"   	classe 5
				]
				guilist [
					guiimage "packages/icons/magicien.jpg" "" 0.5 0
					guiradio "Magicien"     classe 6
				]
				guilist [
					guiimage "packages/icons/kamikaze.jpg" "" 0.5 0
					guiradio "Kamikaze"   	classe 7
				]
				guilist [
					guiimage "packages/icons/faucheuse.jpg" "" 0.5 0
					guiradio "Faucheuse"   classe 8
				]
				guistrut 6
			]
			guibar
		]
		guilist [
			if (= $classe 1) [
				guilist [
					guiimage "packages/icons/soldat.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "SOLDAT"
					]
				]
				guibar
				guitext "Vitesse ^f2+ 0%"
				guitext "Résistance ^f2+ 0%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "Aucun"
			]
			if (= $classe 2) [
				guilist [
					guiimage "packages/icons/medecin.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "MEDECIN"
					]
				]
				guibar
				guitext "Vitesse ^f2+ 0%"
				guitext "Résistance ^f3- 15%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "Medigun"
			]
			if (= $classe 3) [
				guilist [
					guiimage "packages/icons/americain.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "AMERICAIN"
					]
				]
				guibar
				guitext "Vitesse ^f3- 25%"
				guitext "Résistance ^f0+ 25%"
				guitext "Précision ^f3- 25%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "Munitions + 50%"
			]
			if (= $classe 4) [
				guilist [
					guiimage "packages/icons/ninja.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "NINJA"
					]
				]
				guibar
				guitext "Vitesse ^f0+ 20%"
				guitext "Résistance ^f3- 20%"
				guitext "Précision ^f3- 25%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "Deux armes CàC"
				guitext "Dégats au CàC x2"
			]
			if (= $classe 5) [
				guilist [
					guiimage "packages/icons/vampire.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "VAMPIRE"
					]
				]
				guibar
				guitext "Vitesse ^f2+ 0%"
				guitext "Résistance ^f3- 50%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "- 40% des dégâts donnés" "null"
				guitext "par le vampire lui régénèrent" "null"
				guitext "sa santé." "null"
			]
			if (= $classe 6) [
				guilist [
					guiimage "packages/icons/magicien.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "MAGICIEN"
					]
				]
				guibar
				guitext "Vitesse ^f2+ 0%"
				guitext "Résistance ^f3- 25%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Sorts :"
				guitext "- Vitesse"
				guitext "- Précision"
				guitext "- Résistance"
			]
			if (= $classe 7) [
				guilist [
					guiimage "packages/icons/kamikaze.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "KAMIKAZE"
					]
				]
				guibar
				guitext "Vitesse ^f3- 10%"
				guitext "Résistance ^f3- 10%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Spécial :"
				guitext "- Ceinture d'explosifs"
			]
			if (= $classe 8) [
				guilist [
					guiimage "packages/icons/faucheuse.jpg" "" 0 0
					guibar
					guilist [
						guistrut 0.5
						guititle "FAUCHEUSE"
					]
				]
				guibar
				guitext "Vitesse ^f3- 10%
				guitext "Résistance ^f3- 10%"
				guitext "Précision ^f2+ 0%"
				guistrut 0.5
				guitext "Spécial :"
				guitext [- Pour chaque ennemis tués,] "null"
				guitext [la faucheuse gagne un point] "null"
				guitext [de vie en plus durant toute] "null"
				guitext [la partie.] "null"
				
			]
			guilist [guistrut 30]
		]
	]
] 0

newgui credits [
    guititle "CISLATTACK"
	guibar
	guitext "Chef de projet : ^f0VuSurTF1^f~"
	guitext "Site web, comptes, gestion communauté : ^f0LordSpock (PixStudio)^f~"
	guitext "Modèles 3D, idées, maps : ^f0Skyser, JambonBeurreMan^f~"
    guitext "Cube Engine 2 : ^f0Wouter Aardappel van Oortmerssen, Lee eihrul Salzman^f~"
    guitext "www.cislattack.com"
    guitext "www.cubeengine.com"
    guitext "www.tesseract.gg"
] 0

cleared = 0

togglemainmenu = [
    if (! (cleargui 1)) [
        showgui mainmenuingame
    ]
]

bind ESCAPE [togglemainmenu]

genmapitems = [
    looplist curmap $arg1 [
        guibutton $curmap (concat map $curmap) "cube"
    ]
]

showmapshot = [ 
    guibar
    guiimage (concatword "packages/base/" (if (> $numargs 0) [result $arg1] [at $guirollovername 0]) ".jpg") $guirolloveraction 4 1 "data/cube.png"
]

macro playermodelbutton [cleargui 1; playermodel %1]

newgui playermodel [
    guilist [
        guilist [
			guititle "SMILEY"
			guibar
            loop i $numplayermodel [
                guibutton (playermodelname $i) (playermodelbutton $i) (playermodelicon $i)
            ]
        ]
        guibar
        pmidx = (substr $guirolloveraction (strlen (playermodelbutton "")))
        pmidx = (max 0 (min (- $numplayermodel 1) $pmidx))
        guilist [
			guititle "PREVISUALISATION"
			guibar
            guiplayerpreview $pmidx 0 $vwep $guirolloveraction 4 1
        ]
    ]
	guibar
	guititle "HISTOIRE"
	guitextbox (playermodelstory $pmidx) 40 9
] "0"

newgui options [
	guititle "OPTIONS"
	guibar
	guilist [
		guistrut 0
		guiradio "Graphismes" option 1
		guibar
		guiradio "Jouabilité" option 2
		guibar
		guiradio "Commandes" option 3
		guibar
		guiradio "Son" option 4
		guibar
		guiradio "Console" option 5
		guistrut 0
	]
	guibar
	if (= $option 1) [
		if (= $light 0) [
			guilist [
				guilist [
					guitext "Qualité de l'eau"
					guitext "Qualité de l'éclairage"
					guitext "Qualité des particules"
					guitext "Qualité des décorations"
					guitext "Qualité des modèles 3D"
					guicheckbox "Illumination globale" gi
					guicheckbox "Anti-crélénage" tqaa
					guicheckbox "Filtrage anisotrope" anisotrope
					guicheckbox "SSAO" ao
					guicheckbox "HDR" hdr
				]
				guibar
				guilist [
					guilist [
						guiradio "Basse"  lodeau 1 [waterreflect 0 ; caustics 0 ; vertwater 0]
						guibar 
						guiradio "Moyenne" lodeau 2 [waterreflect 0 ; caustics 1 ; vertwater 1]
						guibar 
						guiradio "Haute" lodeau 3 [waterreflect 1 ; caustics 1 ; vertwater 1]
					]
					guilist [
						guiradio "Basse"  smfilter 0 [csmsplits 1 ; smsize 10 ; smminradius 10000 ; smnoshadow 1]
						guibar 
						guiradio "Moyenne" smfilter 2 [csmsplits 2 ; smsize 12 ; smminradius 1000 ; smnoshadow 1]
						guibar 
						guiradio "Haute" smfilter 3 [csmsplits 3 ; smsize 16 ; smminradius 100 ; smnoshadow 0]
					]
					guilist [
						guiradio "Basse"  lodparticules 0 [maxparticles 250 ; softparticles 0 ; maxparticledistance 256]
						guibar 
						guiradio "Moyenne" lodparticules 1 [maxparticles 3000 ; softparticles 1 ; maxparticledistance 1024]
						guibar 
						guiradio "Haute" lodparticules 2 [maxparticles 15000 ; softparticles 1 ; maxparticledistance 4096]
					]
					guilist [
						guiradio "Basse"  grassdist 64 [grassstep 4 ; decalfade 1000 ; maxdecaltris 1024]
						guibar 
						guiradio "Moyenne" grassdist 256 [grassstep 3 ; decalfade 10000 ; maxdecaltris 4096]
						guibar 
						guiradio "Haute" grassdist 512 [grassstep 2 ; decalfade 60000 ; maxdecaltris 20000]
					]
					guilist [
						guiradio "Basse" maxmodelradiusdistance 35
						guibar 
						guiradio "Moyenne" maxmodelradiusdistance 80
						guibar 
						guiradio "Haute" maxmodelradiusdistance 130
					]
					guilist [
						if $gi [
							guiradio "Basse"  rhtaps 12
							guibar 
							guiradio "Moyenne" rhtaps 20
							guibar 
							guiradio "Haute" rhtaps 32
						] [ guitext "Option désactivée" ]
					]
					guilist [
						if $tqaa [
							guiradio "Bas" smaaquality 0 [smaacoloredge 0 ; fxaaquality 0]
							guistrut 1.67
							guibar 
							guiradio "Moyen" smaaquality 1 [smaacoloredge 0 ; fxaaquality 2]
							guistrut 1.85
							guibar
							guiradio "Haut" smaaquality 3 [smaacoloredge 1 ; fxaaquality 3]
						] [ guitext "Option désactivée" ]
					] 
					guilist [
						if $anisotrope [
							guiradio "Bas" aniso 2
							guistrut 1.67
							guibar 
							guiradio "Moyen" aniso 8
							guistrut 1.85
							guibar 
							guiradio "Haut" aniso 16
						] [ guitext "Option désactivée" ]
					]
					guilist [
						if $ao [
							guiradio "Bas" aotaps 3
							guistrut 1.67
							guibar 
							guiradio "Moyen" aotaps 8
							guistrut 1.85
							guibar 
							guiradio "Haut" aotaps 12
						] [ guitext "Option désactivée" ]
					]
				]
			]
			guilist [
				guilist [
					guilist [
						guistrut 21.47
					]
					guitext "Gamma"
				]
				guibar
				guilist [
					guilist [
						guistrut 25
					]
				guislider gamma
				]
			]
			guibar
			guicheckbox "Plein écran"	fullscreen
			guibutton "Résolution de l'affichage" "showgui resolution"
			guicheckbox "Synchronisation verticale"        vsync 1 0
			guibutton "Restaurer la configuration" "exec restore.cfg"
		]
		if (= $light 1) [
			guilist [
				guilist [
					guitext "Qualité de l'eau"
					guitext "Qualité des ombres"
					guitext "Qualité des particules"
					guitext "Qualité des décorations"
					guitext "Qualité des modèles"
					guicheckbox "Brillance" glare
					guicheckbox "Anti-crélénage" aa

				]
				guibar
				guilist [
					guilist [
						guiradio "Basse"  lodeau 1 [waterreflect 0 ;  waterfallrefract 0; caustics 0 ; vertwater 0]
						guibar 
						guiradio "Moyenne" lodeau 2 [waterreflect 0 ; waterfallrefract 0 ; caustics 1 ; vertwater 1]
						guibar 
						guiradio "Haute" lodeau 3 [waterreflect 1 ;   waterfallrefract 1 ; caustics 1 ; vertwater 1]
					]
					guilist [
						guiradio "Basse" shadowmapsize 8 [blurshadowmap 1]
						guibar
						guiradio "Moyenne" shadowmapsize 9 [blurshadowmap 1]
						guibar
						guiradio "Haute" shadowmapsize 10 [blurshadowmap 2]
					]
					guilist [
						guiradio "Basse"  lodparticules 0 [maxparticles 250 ; maxparticledistance 256]
						guibar 
						guiradio "Moyenne" lodparticules 1 [maxparticles 3000 ; maxparticledistance 1024]
						guibar 
						guiradio "Haute" lodparticules 2 [maxparticles 15000 ; maxparticledistance 4096]
					]
					guilist [
						guiradio "Basse"  grassdist 64 [decalfade 1000 ; maxdecaltris 128]
						guibar 
						guiradio "Moyenne" grassdist 256 [decalfade 60000 ; maxdecaltris 1024]
						guibar 
						guiradio "Haute" grassdist 512 [decalfade 300000 ; maxdecaltris 4096]
					]
					guilist [
						guiradio "Basse" lodmodeles 1 [maxmodelradiusdistance 35 ; lightsmodels 0 ; envmapmodels 0 ; glowmodels 0 ; bumpmodels 0 ; matskel 1]
						guibar 
						guiradio "Moyenne" lodmodeles 2 [maxmodelradiusdistance 80 ; lightsmodels 1 ; envmapmodels 1 : glowmodels 0 ; bumpmodels 0 ; matskel 0]
						guibar 
						guiradio "Haute" lodmodeles 3 [maxmodelradiusdistance 130 ; lightmodels 1 ; envmapmodels 1 : glowmodels 1 ; bumpmodels 1 ; matskel 0]
					]
				if $glare [
					glarepreset = 0
					if (= $glarescale 1) [
						if (= $blurglare 4) [glarepreset = 1]
						if (= $blurglare 7) [glarepreset = 3]
					]
					if (= $glarescale 2) [
						if (= $blurglare 3) [glarepreset = 2]
						if (= $blurglare 7) [glarepreset = 4]
					]
					guilist [
						guiradio "Légère" glarepreset 1 [blurglare 4; glarescale 1]
						guibar
						guiradio "Moyenne" glarepreset 2 [blurglare 3; glarescale 2]  
						guibar
						guiradio "Forte" glarepreset 4 [blurglare 7; glarescale 2]
					] [ guitext "Option désactivée" ]
				]
				if $aa [
					guilist [
						guiradio "Bas" fsaa 2
						guistrut 1.67
						guibar 
						guiradio "Moyen" fsaa 4
						guistrut 1.85
						guibar 
						guiradio "Haut" fsaa 8
					]
				] [ guitext "Option désactivée" ]
				]
			]
			guilist [
				guilist [
					guilist [
						guistrut 20.85
					]
					guitext "Gamma"
				]
				guibar
				guilist [
					guilist [
						guistrut 25
					]
				guislider gamma
				]
			]
			guicheckbox "Plein écran"	fullscreen
			guibutton "Résolution de l'affichage" "showgui resolution"
			guicheckbox "Synchronisation verticale"        vsync 1 0
			guibutton "Restaurer la configuration" "exec restore.cfg"
		]
	]
	if (= $option 2) [
		guilist [
			guitext "Langue"
			guibar 
			guiradio "Francais" langage 0
			guibar 
			guiradio "English" langage 1
		]
		guistrut 0.1
		guilist [
			guilist [
				guitext "Sensibilité de la souris : "
				guitext "Champ visuel :"
				guitext "Taille du viseur :"
			]
			guibar
			guilist [
				guilist [
					guistrut 30
				]
			guislider sensitivity 1 10
			guislider fov
			guislider crosshairsize
			]
		]
		guicheckbox "Inverser haut/bas de la souris."      invmouse
		guicheckbox "Toujours utiliser les couleurs d'ennemis" teamskins
		guicheckbox "Afficher les aliés sur le radar" radarteammates 1
		guicheckbox "Afficher le sang"   blood
		guicheckbox "Afficher les dommages" afficherdommages
		guicheckbox "Afficher les pseudals" afficherpseudals
		guicheckbox "Afficher les règles" showrules 1
		guicheckbox "Afficher IPS" showfps
		guibutton "Remettre tout par défaut" "exec restore.cfg"
	]
	if (= $option 3) [
		guilistsplit n 2 $bindactions [
			guilist [
				guitext (tabify (concatword $n ": ") 4)
				[newbinds@i] = (searchbinds $n)
				guikeyfield [newbinds@i] -9 [
					oldbinds = (searchbinds [@@n])
					looplist j $oldbinds [bind $j ""]
					looplist j $[newbinds@@i] [bind $j [@@@n]]
				]
			]
		] [guibar]
		guibutton "Remettre tout par défaut" "exec restore.cfg"
	]
	if (= $option 4) [
		guilist [
			guilist [
				guitext "Volume des bruitages"
				guitext "Volume des musiques"
				guitext "Nombre max de sons lus simultanément"
				guitext "Fréquence du son"
				guitext "Taille de la mémoire tampon"
			]
			guibar
			guilist [
				guilist [
					guistrut 30
				]
			guislider soundvol
			guislider musicvol
			guislider soundchans 20 500
			guilistslider soundfreq "11025 22050 44100"
			guislider soundbufferlen
			]
		]
		guicheckbox "Synchroniser postion avec Mumble" mumble
	]
	if (= $option 5) [
	    guicheckbox "Console du tchat :"  miniconfilter 0x300 0
		guitext "Taille de la console rapide (en lignes) :"
		guislider consize
		guitext "Filtres des messages :"
		guilist [
			guilist [
				guibitfield "Messages d'information" confilter 0x01
				guibitfield "Messages d'alerte" confilter 0x02
				guibitfield "Messages d'erreurs" confilter 0x04
				guibitfield "Messages d'initialisation" confilter 0x10
				guibitfield "Messages de script" confilter 0x20
			]
			guibar
				guilist [
				guibitfield "Messages du tchat" confilter 0x100
				guibitfield "Messages du tchat d'équipe" confilter 0x200
				guibitfield "Messages d'événénments du jeu" confilter 0x400
				guibitfield "Messages de ses frags" confilter 0x800
				guibitfield "Messages des autres frags" confilter 0x1000
				guibitfield "Messages des frags d'équipe" confilter 0x2000
			]
		]
		guitext "Taille de la console complète (En % de l'écran) :"
		guislider fullconsize
		guitext "Filtres des messages :"
		guilist [
			guilist [
				guibitfield "Messages d'information" fullconfilter 0x01
				guibitfield "Messages d'alerte" fullconfilter 0x02
				guibitfield "Messages d'erreurs" fullconfilter 0x04
				guibitfield "Messages d'initialisation" fullconfilter 0x10
				guibitfield "Messages de script" fullconfilter 0x20
			]
			guibar
			guilist [
				guibitfield "Messages du tchat" fullconfilter 0x100
				guibitfield "Messages du tchat d'équipe" fullconfilter 0x200
				guibitfield "Messages d'événénments du jeu" fullconfilter 0x400
				guibitfield "Messages de ses frags" fullconfilter 0x800
				guibitfield "Messages des autres frags" fullconfilter 0x1000
				guibitfield "Messages des frags d'équipe" confilter 0x2000
			]
		]
	]
] 0

newgui resolution [
	guistayopen [
		guilist [
			guilist [
				guitext "4:3"
				@@@@(resbutton 800 600)
				@@@@(resbutton 1024 768)
				@@@@(resbutton 1152 864)
				@@@@(resbutton 1280 960)
				@@@@(resbutton 1400 1050)
				@@@@(resbutton 1600 1200)
				@@@@(resbutton 1792 1344)
				@@@@(resbutton 1856 1392)
				@@@@(resbutton 1920 1440)
				@@@@(resbutton 2048 1536)
				@@@@(resbutton 2800 2100)
				@@@@(resbutton 3200 2400)
			]
			guibar
			guilist [
				guitext "16:10"
				@@@@(resbutton 1024 640)
				@@@@(resbutton 1280 800)
				@@@@(resbutton 1440 900)
				@@@@(resbutton 1600 1000)
				@@@@(resbutton 1680 1050)
				@@@@(resbutton 1920 1200)
				@@@@(resbutton 2048 1280)
				@@@@(resbutton 2560 1600)
				@@@@(resbutton 3840 2400)
			]
			guibar
			guilist [
				guitext "16:9"
				@@@@(resbutton 1024 600)
				@@@@(resbutton 1280 720)
				@@@@(resbutton 1366 768)
				@@@@(resbutton 1600 900)
				@@@@(resbutton 1920 1080)
				@@@@(resbutton 2048 1152)
				@@@@(resbutton 3840 2160)
			]
			guibar
			guilist [
				guitext "5:4"
				@@@@(resbutton 1280 1024)
				@@@@(resbutton 1600 1280)
				@@@@(resbutton 2560 2048)
			]
			guibar
			guilist [
				guitext "5:3"
				@@@@(resbutton 800 480)
				@@@@(resbutton 1280 768)

				guibar
				guitext "Customisé"
				guilist [
					customw = $scr_w
					customh = $scr_h
					guifield customw 4 [scr_w $customw]
					guifield customh 4 [scr_h $customh]
				]
			]
		]
	]
] 0

startbotmatch = [
    loop i $botmatchcount [addbot (rnd (+ $botmatchmaxskill 1) $botmatchminskill)]
] 0

modes =  [
"T.L.T." "T.L.T. (Normal)" "T.L.T. (Aléatoire)" "T.L.T. (Full stuff)" "T.L.T. (Identique)" "T.L.T. (Corps à corps)"
"T.L.T. (Normal)" "T.L.T. (Aléatoire)" "T.L.T. (Full stuff)" "T.L.T. (Identique)" "T.L.T. (Corps à corps)"
"Conquète (Normal)" "Conquète (Aléatoire)" "Conquète (Full stuff)" "Conquète (Identique)" "Conquète (Corps à corps)"
"Drapeau (Normal)" "Drapeau (Aléatoire)" "Drapeau (Full stuff)" "Drapeau (Identique)" "Drapeau (Corps à corps)"
"Ananas (Normal)" "Ananas (Aléatoire)" "Ananas (Full stuff)" "Ananas (Identique)" "Ananas (Corps à corps)"
"Collecte (Normal)" "Collecte (Aléatoire)" "Collecte (Full stuff)" "Collecte (Identique)" "Collecte (Corps à corps)"
]

maps = ["Village" "Village" "Usine" "Chateaux" "Test"]

newgui match [
	guititle "PARAMETRES DE LA PARTIE"
	guibar
	guilist [
		guilist [
			guititle "MODE"
			guiradio  "T.L.T."					modedejeu 0 [mode 1]
			guiradio  "T.L.T. par équipe"		modedejeu 1	[mode 6]
			guiradio  "Conquète de bases"		modedejeu 2 [mode 11]
			guiradio  "Plantage de drapeau"		modedejeu 3 [mode 16]
			guiradio  "Smiley-ananas"			modedejeu 4 [mode 21]
			guiradio  "Collecte de pixels"	modedejeu 5 [mode 26]
		]
		guibar

		
		if (= $modedejeu 0) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 1
				guiradio "Aléatoire" 		mode 2
				guiradio "Identique" 		mode 4
				guiradio "Full stuff" 		mode 3
				guiradio "Corps à corps" 	mode 5
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 1) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 6
				guiradio "Aléatoire" 		mode 7
				guiradio "Identique" 		mode 9
				guiradio "Full stuff" 		mode 8
				guiradio "Corps à corps" 	mode 10
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 2) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 11
				guiradio "Aléatoire" 		mode 12
				guiradio "Identique" 		mode 14
				guiradio "Full stuff" 		mode 13
				guiradio "Corps à corps" 	mode 15
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 3) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 16
				guiradio "Aléatoire" 		mode 17
				guiradio "Identique" 		mode 19
				guiradio "Full stuff" 		mode 18
				guiradio "Corps à corps" 	mode 20
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 4) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 21
				guiradio "Aléatoire" 		mode 22
				guiradio "Identique" 		mode 24
				guiradio "Full stuff" 		mode 23
				guiradio "Corps à corps" 	mode 25
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 5) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 26
				guiradio "Aléatoire"		mode 27
				guiradio "Identique" 		mode 29
				guiradio "Full stuff" 		mode 28
				guiradio "Corps à corps" 	mode 30
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		guibar
		guilist [
			guititle "DURÉE"
			guiradio "5 minutes" dureedepartie 5
			guiradio "10 minutes" dureedepartie 10
			guiradio "15 minutes" dureedepartie 15
			guiradio "30 minutes" dureedepartie 30
			guilist [
				guiradio "1 heure " dureedepartie 60
				guiimage "packages/icons/bave.jpg" "" 0.5 0
			]
			guilist [
				guitext "Au choix "
				guifield dureedepartie 3
			]
		]
	]
	guistrut 1
	guititle "NIVEAU DES BOTS"
	guilist [
		guistrut 8
		guiradio "Kévin" botmatchminskill 0 [botmatchmaxskill 20]
		guibar
		guiradio "Noob" botmatchminskill 20 [botmatchmaxskill 40]
		guibar
		guiradio "Bof" botmatchminskill 40 [botmatchmaxskill 60]
		guibar
		guiradio "Bon" botmatchminskill 60 [botmatchmaxskill 88]
		guibar
		guiradio "Roxxor" botmatchminskill 88 [botmatchmaxskill 99]
		guistrut 8
	]
	guistrut 1
	guititle "NOMBRE DE BOTS"
	guislider botmatchcount 1 128
	guistrut 1
	guibutton "Choisir la map" [guionclear [startbotmatch] ; showgui maps] "map"
] 0

newgui vote [
	guititle "PARAMETRES DE LA PARTIE"
	guibar
	guilist [
		guilist [
			guititle "MODE"
			guiradio  "T.L.T."					modedejeu 0
			guiradio  "T.L.T. par équipe"		modedejeu 1
			guiradio  "Conquète de bases"		modedejeu 2
			guiradio  "Plantage de drapeau"		modedejeu 3
			guiradio  "Smiley-ananas"			modedejeu 4
			guiradio  "Collection de pixels"	modedejeu 5
		]
		guibar

		
		if (= $modedejeu 0) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 1
				guiradio "Aléatoire" 		mode 2
				guiradio "Identique" 		mode 4
				guiradio "Full stuff" 		mode 3
				guiradio "Corps à corps" 	mode 5
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 1) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 6
				guiradio "Aléatoire" 		mode 7
				guiradio "Identique" 		mode 9
				guiradio "Full stuff" 		mode 8
				guiradio "Corps à corps" 	mode 10
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 2) [
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 11
				guiradio "Aléatoire" 		mode 12
				guiradio "Identique" 		mode 14
				guiradio "Full stuff" 		mode 13
				guiradio "Corps à corps" 	mode 15
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 3) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 16
				guiradio "Aléatoire" 		mode 17
				guiradio "Identique" 		mode 19
				guiradio "Full stuff" 		mode 18
				guiradio "Corps à corps" 	mode 20
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 4) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 21
				guiradio "Aléatoire" 		mode 22
				guiradio "Identique" 		mode 24
				guiradio "Full stuff" 		mode 23
				guiradio "Corps à corps" 	mode 25
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		if (= $modedejeu 5) [	
			guilist [
				guititle "TYPE"
				guiradio "Normal" 			mode 26
				guiradio "Aléatoire"		mode 27
				guiradio "Identique" 		mode 29
				guiradio "Full stuff" 		mode 28
				guiradio "Corps à corps" 	mode 30
				guicheckbox "^f3Mode hardcore^f~" hardcore
			]
		]
		guibar
		guilist [
			guititle "MAP"
			guiradio "Village" 		choix 1
			guiradio "Usine" 		choix 2
			guiradio "Chateaux" 	choix 3
			guiradio "2Fort"		choix 4
			guiradio "Test" 		choix 5
		]
	]
	guistrut 1
	
	guibar
	guilist [
		guilist [
			guititle "RESUMÉ"
			guibar
			guitext (concatword (at $modes $mode))
			guitext "Multijoueur"
			guitext (concatword (at $maps $choix))
		]
		guibar
		guilist [
			if (= $choix 0) [guiimage "packages/base/village.jpg" "" 4 0]
			if (= $choix 1) [guiimage "packages/base/village.jpg" "" 4 0]
			if (= $choix 2) [guiimage "packages/base/usine.jpg" "" 4 0]
			if (= $choix 3) [guiimage "packages/base/chateaux.jpg" "" 4 0]
			if (= $choix 4) [guiimage "packages/base/2fort.jpg" "" 4 0]
			if (= $choix 5) [guiimage "packages/base/test.jpg" "" 4 0]
		]
	]
	guibar
	if (= $choix 0) [ guibutton "Commencay la partie" [map VILLAGE] ]
	if (= $choix 1) [ guibutton "Commencay la partie" [map VILLAGE] ]
	if (= $choix 2) [ guibutton "Commencay la partie" [map USINE] ]
	if (= $choix 3) [ guibutton "Commencay la partie" [map CHATEAUX] ]
	if (= $choix 4) [ guibutton "Commencay la partie" [map 2FORT] ]
	if (= $choix 5) [ guibutton "Commencay la partie" [map TEST] ]
] 0

newgui maps [
	guititle "CHOIX DE LA MAP"
	guibar
	guilist [
		guilist [
			guilist [
				guistrut 4
				guititle "MAPS"
				guistrut 4
			]
			guibar
			guiradio "Village" 		choix 1
			guiradio "Usine" 		choix 2
			guiradio "Chateaux" 	choix 3
			guiradio "2Fort"		choix 4
			guiradio "Test" 		choix 5
		]
		guibar
		guilist [
			guilist [
				guistrut 5
				guititle "RESUMÉ"
				guistrut 5
			]
			guibar
			guitext (concatword (at $modes $mode))
			guitext (concatword (at $botmatchcount) " bots")
			guitext (concatword (at $maps $choix))
			if (= $choix 0) [guiimage "packages/base/village.jpg" "" 4 0]
			if (= $choix 1) [guiimage "packages/base/village.jpg" "" 4 0]
			if (= $choix 2) [guiimage "packages/base/usine.jpg" "" 4 0]
			if (= $choix 3) [guiimage "packages/base/chateaux.jpg" "" 4 0]
			if (= $choix 4) [guiimage "packages/base/2fort.jpg" "" 4 0]
			if (= $choix 5) [guiimage "packages/base/test.jpg" "" 4 0]
		]
	]
	guibar
	if (= $choix 0) [ guibutton "Commencay la partie" [map VILLAGE] ]
	if (= $choix 1) [ guibutton "Commencay la partie" [map VILLAGE] ]
	if (= $choix 2) [ guibutton "Commencay la partie" [map USINE] ]
	if (= $choix 3) [ guibutton "Commencay la partie" [map CHATEAUX] ]
	if (= $choix 4) [ guibutton "Commencay la partie" [map 2FORT] ]
	if (= $choix 5) [ guibutton "Commencay la partie" [map TEST] ]
] 0

newgui serveurs [
    guistayopen [
        guititle "SERVEURS"
        guibar
        guilist [
			guibutton "Actualisay la liste" "updatefrommaster"
			guibar
			guicheckbox "Afficher le serveur LAN" searchlan
			guibar
			guibutton "Se connectay au LAN" "lanconnect"
		]
		guibar
		guiservers
		guibar
		guilist [
			guitext "IP : "
            guifield ipserveur 22
			guibar
            guibutton "Ajouter le serveur à la liste" " addserver (concatword $ipserveur)"
		]
	]
] 0

newgui admin [
	guititle "ADMINISTRATION"
	guibar
	guistayopen [
		guilist [
			guitext "Niveau du bot : "
			guibar
			guifield niveau 3  (concatword $niveau)
		]
	    guilist [
	        guibutton "Ajouter un bot" "addbot $niveau"
	        guibar
		    guibutton "Supprimer un bot" "delbot $niveau"
	    ]
		guistrut 1
		guibar
		guistrut 1
    	looplist cn (listclients) [
            guilist [
            	guitext (concatword (getclientname $cn) ": ") (getclienticon $cn)
            	guibutton "Kicker" (concat "kick" $cn)
        	]
	    ]
	]
] 0

guilistsplit = [
  guilist [
    i = 0
    l = (listlen $arg3)
    z = (div (+ $l (- $arg2 1)) $arg2)
    loop a $arg2 [
      guilist [
        t = (min (+ $i $z) $l)
        while [< $i $t] [
          $arg1 = (at $arg3 $i)
          arg4
          i = (+ $i 1)
        ]
      ]
      if (&& (>= $numargs 5) (< (+ $a 1) $arg2)) [arg5]
    ]
  ]
]

resbutton = [format [
    guibutton "%1x%2" "screenres %1 %2" (if (&& (= $scr_w %1) (= $scr_h %2)) [result "radio_on"] [result "radio_off"])
]  $arg1  $arg2]

newgui statistiques [
]
