togglemainmenu = [
    if (! (cleargui 1)) [
        showgui main2
    ]
]

bind ESCAPE [togglemainmenu]

newgui main [
	guitext "Bienvenue sur la version Alpha de Cislattack jeune loutre :hap: "
	guitext "N'oublies pas que c'est une Alpha et que c'est loin d'être fini."
	guilist [ 
		guibutton "JOUAY" "showgui main2" 
		guibar 
		guibutton "QUITTAY" "quit" "exit"
	]
] 0

newgui main2 [
    guilist [
        guitext "Pseudal: " (playermodelicon)
        newname = (getname)
        guifield newname 15 [name $newname]
    ]
    guibutton (concat "Smiley:" (playermodelname)) [guirolloveraction = (playermodelbutton $playermodel); showgui playermodel] (playermodelicon)
    guibar
    guibutton "Multijoueurs"  "showgui servers"
    if (isconnected) [
        guibar
        if (|| $editing (m_edit (getmode))) [
            guibutton "Editeur de map" 	"showgui edition"
        ]
        guibutton "Votay le mode/la map" 	"showgui gamemode"
        guibutton "Se connectay au LAN"  	"lanconnect  "           
        guibutton "Changay d'équipe" 		[if (strcmp (getteam) "good") [team evil] [team good]]
        guibutton "Devenir spectateur" 		[spectator (! (isspectator (getclientnum)))] "spectator"
        guibutton "Géray serveur" 			[showgui master]
        guibar
        guibutton "Options"  				[showgui options]
        guibutton "Se déconnectay" 			"disconnect"         "exit"
    ] [
        guibutton "Jouay contre des bots"    "showgui botmatch"
        guibar
        guibutton "Options"        "showgui options"
        guibutton "Quittay"        "quit"
    ]
] 0

genmapitems = [
    looplist curmap $arg1 [
        guibutton $curmap (concat map $curmap) "cube"
    ]
]

showmapshot = [ 
    guibar
    guiimage (concatword "packages/base/" (if (> $numargs 0) [result $arg1] [at $guirollovername 0]) ".jpg") $guirolloveraction 4 1 "data/cube.png"
]

macro playermodelbutton [cleargui 1; playermodel %1]

newgui playermodel [
    guilist [
        guilist [
            loop i $playermodelnum [
                guibutton (playermodelname $i) (playermodelbutton $i) (playermodelicon $i)
            ]
        ]
        guibar
        pmidx = (substr $guirolloveraction (strlen (playermodelbutton "")))
        pmidx = (max 0 (min (- $playermodelnum 1) $pmidx))
        guilist [
            guiplayerpreview $pmidx 0 6 $guirolloveraction 4 1
            guitextbox (playermodelstory $pmidx) 40 9
        ]
    ]
]

newmapsize = 12
savemap_name = temp

newgui Edition [
    guibutton "Zones"                           				"showgui materials"
	guibar
    guibutton "Mode édition       (E)"              			"edittoggle"
    guibutton "Mode relief        (H)"              			""
    guibutton "Sélectionner       (Clic gauche)"				""
    guibutton "Déselectionner     (Espace)"         			"cancelsel"
    guibutton "Sélectionner coins (Maintenir cic mollette)"  	""
    guibutton "Etendre sélection  (Clic droit)"     			""
    guibutton "Réorienter         (Clic droit)"     			""
    guibutton "Déplacer sélection (Maintenir clic droit)"       ""
    guibutton "Copier             (C)"			                "copy"
    guibutton "Coller             (V)"			                "paste"

    guitab Objets
    guilist [
      guilist [
        guibutton "drop entities.."            "showgui dropent"
        guibutton "Modèle 3D"                  "showgui mapmodels"

        guibutton "Point de respawn"		"newent spawn"
        guibutton "Mossberg 500" 			"newent mossberg500"
        guibutton "Uzi" 					"newent uzi"
        guibutton "SMAW"					"newent SMAW"
        guibutton "SV 98"					"newent SV_98"
        guibutton "M32"						"newent M32
		guibutton "Minigun"					"newent minigun"
		guibutton "Famas"					"newent famas"
		guibutton "Pistolet alien"			"newent pistoletalien"
		guibutton "Glock .21"				"newent glock"
      ]
      guilist [
        guibutton "Téléportation"                   "showgui newteleport"

        guibutton "Panachay"				"newent panachay"
        guibutton "Cochon grillay"			"newent cochongrillay"
        guibutton "Armure en fer"			"newent armurefer"
        guibutton "Armure en diamant"		"newent armurediamant"
        guibutton "Boule magique"			"newent boulemagique"
      ]
    ]

    guitab Outils
    guibutton "Mirroir                       (X)"           "flip"
    guibutton "Annuler action                (U)"           "undo"
    guibutton "Refaire action                (I)"           "redo"
    guibutton "Supprimer                     (Retour)"      "editdel"
    guibutton "Palette de textures           (F2)" 			"showtexgui"
    guibutton "Editon d'objets               (F3)" 			"showentgui"
    guibutton "Liste de modèles 3D           (F4)" 		 	"showgui mapmodels"
    guibutton "Sélectionner tous les objets  (N)" 			"selentfindall"
    guibutton "Modifier objet                (Slash)" 		"selentedit"
    guicheckbox "Afficher polygones          (7)"			outline
    guicheckbox "Désafficher textures        (8)"    		wireframe

    guitab Mollette
    guitext "Pousser/tirer sélection     Molette seulement"
    guitext "Pousser face d'un cube      F + Molette"
    guitext "Changer taille de grille    G + Molette"
    guitext "Changer texture             Y + Molette"
    guitext "Rotation                    R + Molette"
    guitext "Pousser coin avec curseur   Q + Molette"
    guitext "Pousser/Tirer relief        LALT + Molette"
    guitext "Changer brosse de relief    B + Molette"

    guitab Eclairage
	guibutton "Ajouter lumière"                 "resetlight;showgui newlight"
	guibutton "Lumière du soleil et ambiance"	"resetlight;showgui sunlight"
    guicheckbox "Ajouter spot" 					"newent spot"
    guibutton "Calculer lumières" 				"calclight 1"
    guicheckbox "Désactiver/activer éclairage" 	fullbright

    guitab MixTextures
    guitext "Mode de peinture :"
	guiradio "Off               (keypad 0)" blendpaintmode 0
	guiradio "Remplacer	        (keypad 1)" blendpaintmode 1
	guiradio "Creuser           (keypad 2)" blendpaintmode 2
	guiradio "Remplir           (keypad 3)" blendpaintmode 3
	guiradio "Creuser inversé   (keypad 4)" blendpaintmode 4
	guiradio "Remplir inversé   (keypad 5)" blendpaintmode 5
    guibar
    guitext "Peindre            (Clic gauche)"
	guibutton "Changer brosse   (Molette)" "nextblendbrush"
	guibutton "Rotation brosse	(Bouton molette)" "rotateblendbrush"
	guibutton "Supprimmer tout               (Commande /clearblendmap" "clearblendmap"
	guibutton "Supprimmer dans la sélection  (Commande /clearblendmapsel" "clearblendmapsel"

    guitab Map
    guitext   "Sauvegarder la map :"
    guifield  savemap_name 20 [ savemap $savemap_name ]
    guibutton [load @savemap_name map]             	"map $savemap_name"
    guibutton "Nouvelle map"          				"newmap $newmapsize"
    guislider "Taille de la nouvelle map" 10 16
    guibutton "Elargir map (X2)"              		"mapenlarge"
    guitext   "Cache de la fonction annuler (en MB) "
    guislider "undomegs" 1 10
    guibutton "Optimiser la géométrie (important)"	"remip"
    guibutton "Définir auteur + titre de la map"    "saycommand [/maptitle ]"

    guitab skybox
    guilist [
        guistayopen [
            guilist [ genskyitems $skies1 ]
            showskyshot
        ]
    ]

    guitab cfg
	guitext "Fichier de config de votre map (.cfg)"
    guitext (mapcfgname)
    showfileeditor (mapcfgname) -60 15
] "Edition"

skies1 = [
ciel/1
ciel/2
ciel/3
ciel/4
ciel/5
]

genskyitems = [
    looplist cursky $arg1 [
        guibutton $cursky (concat skybox $cursky) //"cube"
    ]
]

alias showskyshot [ guibar; guiimage (concatword "<thumbnail:128>packages/" (if (> $numargs 0) [result $arg1] [result (at $guirollovername 0)]) "_ft.jpg") $guirolloveraction 4 1 "data/cube.png"]

setting_entediting = 1

newgui materials [
    guibutton "Air"                        "editmat air"
    guibutton "Eau"                        "editmat water"
    guibutton "Lave"                       "editmat lava"
    guibutton "Vitre"                      "editmat glass"
    guibutton "Collision"                  "editmat clip"
    guibutton "Pas de collision"           "editmat noclip"
    guibutton "Collision monstres"         "editmat gameclip"
    guibutton "Mort"                       "editmat death"
    guibutton "Transparance"               "editmat alpha"

    guicheckbox "show material volumes"    showmat
] "Zones"

newgui dropent [
    guitext "Placer les objets :"
    guiradio "Sur le sol"                 		entdrop 1
    guiradio "Sur la sélection"                 entdrop 2
    guiradio "Sur le sol à la sélection"    	entdrop 3
    guiradio "Sur la position actuelle"         entdrop 0
    guibar
    guicheckbox "Objet centré sur la grille"    entselsnap
    guicheckbox "Sélection d'objet"         	setting_entediting 1 0 [ entediting $setting_entediting ]
] "Placement des objets"

resetlight = [
    lightcolour = 0
    lightbright = 1
    lightset 255 255 255
    lightradius = 128
    lightshadows = 0
]

lightset = [
    lightr = $arg1
    lightg = $arg2
    lightb = $arg3
    if (= $lightbright 0) lightscale
]

lightscale = [
    if (= $lightbright 0) [
        lightr = (div $lightr 2); lightg = (div $lightg 2); lightb = (div $lightb 2)
    ] [
        lightr = (min 255 (* $lightr 2)); lightg = (min 255 (* $lightg 2)); lightb = (min 255 (* $lightb 2))
    ]
]

lightcmd = [
    concat newent lumiere $lightradius $lightr $lightg $lightb $lightshadows
]

sunlightcmd = [
    concat sunlight $lightr $lightg $lightb
]

ambientcmd = [
    concat ambient $lightr $lightg $lightb
]

newgui newlight [
    guibutton (lightcmd)
    guibar
    guitext "Couleur :"
    guicolor (+ (* (+ (* $lightr 256) $lightg) 256) $lightb)
    guislider lightr 0 255
    guislider lightg 0 255
    guislider lightb 0 255
    guilist [
        guicheckbox "Brillant"    lightbright 1 0 [lightscale]
        guibar
        guiradio "Blanc"        lightcolour 0 [lightset 255 255 255]
        guiradio "Bleu"         lightcolour 1 [lightset 192 192 255]
        guiradio "Rouge"        lightcolour 2 [lightset 255 192 192]
        guiradio "Vert"         lightcolour 3 [lightset 192 255 192]
        guiradio "Jaune"        lightcolour 4 [lightset 255 255 192]
        guiradio "Violet"       lightcolour 5 [lightset 255 192 255]
        guiradio "Turquoise"    lightcolour 6 [lightset 192 255 255]
    ]
    guitext "Rayon :"
    guislider lightradius 0 512
    guilist [
        guitext "Ombrage"
        guibar
        guiradio "Dynamique" lightshadows 0
        guiradio "Statique" lightshadows 2
        guiradio "Aucun" lightshadows 1
    ]
] "Nouvelle lumière"

newgui sunlight [
	guibutton (sunlightcmd)
    guibar
    guitext "Couleur :"
    guicolor (+ (* (+ (* $lightr 256) $lightg) 256) $lightb)
    guislider lightr 0 255
    guislider lightg 0 255
    guislider lightb 0 255
	guitext "Pour la positon du soleil utiliez la commande /getsundir en visant où se trouve le soleil."
	guibar
	guibar
	guibutton (ambientcmd)
    guibar
    guitext "Couleur :"
    guicolor (+ (* (+ (* $lightr 256) $lightg) 256) $lightb)
    guislider lightr 0 255
    guislider lightg 0 255
    guislider lightb 0 255
]
